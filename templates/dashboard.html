<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Chat Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { height: 100vh; overflow: hidden; }
        .sidebar { background-color: #f8f9fa; border-right: 1px solid #dee2e6; height: 100vh; overflow-y: auto; }
        .chat-area { height: 90vh; overflow-y: auto; padding: 20px; }
        .input-area { height: 10vh; background: white; padding: 15px; border-top: 1px solid #ddd; }
        .message-user { text-align: right; margin: 10px; }
        .message-bot { text-align: left; margin: 10px; }
        .bubble { display: inline-block; padding: 10px 15px; borderRadius: 20px; max-width: 70%; }
        .bg-user { background-color: #0d6efd; color: white; }
        .bg-bot { background-color: #e9ecef; color: black; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        
        <div class="col-md-3 sidebar p-3">
            <h4>My Documents</h4>
            <div class="card p-2 mb-3 shadow-sm">
                <form id="uploadForm" onsubmit="uploadFile(event)">
                    <div class="mb-2">
                        <input class="form-control form-control-sm" type="file" id="pdfFile" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm w-100">Upload PDF</button>
                </form>
                <small id="uploadStatus" class="text-muted mt-1"></small>
            </div>
            <h5>History</h5>
            <div class="list-group" id="historyList">
                <a href="#" class="list-group-item list-group-item-action active">Current Chat</a>
                <a href="#" class="list-group-item list-group-item-action">Project Alpha</a>
                <a href="#" class="list-group-item list-group-item-action">Legal Docs</a>
            </div>
        </div>

        <div class="col-md-9">
            <div class="chat-area" id="chatContainer">
                <div class="message-bot">
                    <div class="bubble bg-bot">Hello! Upload a document to start asking questions.</div>
                </div>
            </div>
            <div class="input-area d-flex align-items-center">
                <input type="text" id="userMsg" class="form-control me-2" placeholder="Ask something about your file...">
                <button onclick="sendMessage()" class="btn btn-success">Send</button>
            </div>
        </div>

    </div>
</div>

<script>
    async function uploadFile(event) {
        event.preventDefault();
        const fileInput = document.getElementById('pdfFile');
        const formData = new FormData();
        formData.append("uploaded_file", fileInput.files[0]);

        document.getElementById('uploadStatus').innerText = "Uploading...";
        const response = await fetch('/api/upload', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        document.getElementById('uploadStatus').innerText = "Done! ID: " + result.config.filename;
    }
    async function sendMessage() {
        const input = document.getElementById('userMsg');
        const text = input.value;
        if (!text) return;

        addBubble(text, 'user');
        input.value = "";
        setTimeout(() => {
            addBubble("I received: " + text, 'bot');
        }, 500);
    }

    function addBubble(text, sender) {
        const div = document.createElement('div');
        div.className = sender === 'user' ? 'message-user' : 'message-bot';
        div.innerHTML = `<div class="bubble ${sender === 'user' ? 'bg-user' : 'bg-bot'}">${text}</div>`;
        document.getElementById('chatContainer').appendChild(div);
        document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
    }
</script>

</body>
</html>
